(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2d0b3401"],{2827:function(t,e,i){"use strict";i.r(e);var a=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",[i("v-stepper",{staticClass:"mx-3 mt-5",attrs:{"alt-labels":t.altLabels},model:{value:t.e1,callback:function(e){t.e1=e},expression:"e1"}},[[i("v-stepper-header",[t._l(t.steps,(function(e){return[i("v-stepper-step",{key:e+"-step",attrs:{complete:t.e1>e,step:e,editable:t.editable}},[t._v("Step "+t._s(e))])]}))],2),i("v-stepper-items",t._l(t.steps,(function(e){return i("v-stepper-content",{key:e+"-content",attrs:{step:e}},[1===e?i("v-card",{attrs:{elevation:"0"}},[i("v-card-title",{staticClass:"d-flex justify-center"},[t._v("记录游记")]),i("v-card-text",[i("v-text-field",{attrs:{"error-messages":t.titleErrors,label:"标题",counter:80,required:"",clearable:""},on:{blur:function(e){return t.$v.title.$touch()}},model:{value:t.title,callback:function(e){t.title="string"===typeof e?e.trim():e},expression:"title"}}),i("v-file-input",{attrs:{chips:"",loading:t.load,accept:"image/*","show-size":"",label:"封面图","prepend-icon":"mdi-camera",required:""},on:{change:t.uploadfile,"click:clear":t.clickclear},model:{value:t.pic,callback:function(e){t.pic=e},expression:"pic"}}),i("v-img",{directives:[{name:"show",rawName:"v-show",value:t.imgshow,expression:"imgshow"}],attrs:{src:t.picurl}}),i("v-menu",{ref:"menu",refInFor:!0,attrs:{"close-on-content-click":!1,"return-value":t.date,transition:"scale-transition","offset-y":"","min-width":"290px"},on:{"update:returnValue":function(e){t.date=e},"update:return-value":function(e){t.date=e}},scopedSlots:t._u([{key:"activator",fn:function(e){var a=e.on;return[i("v-text-field",t._g({attrs:{label:"游记第一天日期","prepend-icon":"event",readonly:"",required:"","error-messages":t.dateErrors},on:{blur:function(e){return t.$v.date.$touch()}},model:{value:t.date,callback:function(e){t.date=e},expression:"date"}},a))]}}],null,!0),model:{value:t.menu,callback:function(e){t.menu=e},expression:"menu"}},[i("v-date-picker",{attrs:{"no-title":"",scrollable:""},model:{value:t.date,callback:function(e){t.date=e},expression:"date"}},[i("v-spacer"),i("v-btn",{attrs:{text:"",color:"primary"},on:{click:function(e){t.menu=!1}}},[t._v("取消")]),i("v-btn",{attrs:{text:"",color:"primary"},on:{click:function(e){return t.$refs.menu[0].save(t.date)}}},[t._v("确定")])],1)],1),i("v-text-field",{attrs:{label:"主要地点",required:"",clearable:"","error-messages":t.locationErrors},on:{blur:function(e){return t.$v.location.$touch()}},model:{value:t.location,callback:function(e){t.location="string"===typeof e?e.trim():e},expression:"location"}})],1)],1):i("v-card",{staticClass:"mx-3 mt-4",attrs:{elevation:"0"}},[i("v-card-title",{staticClass:"d-flex justify-center"},[t._v("为游记增加卡片")]),i("v-item-group",{model:{value:t.selected,callback:function(e){t.selected=e},expression:"selected"}},[i("v-row",[t._l(t.items,(function(e){return i("v-col",{key:e.id,staticStyle:{cursor:"pointer"},attrs:{cols:"12",md:"6"}},[i("v-hover",{scopedSlots:t._u([{key:"default",fn:function(a){var s=a.hover;return[i("v-item",["img"===t.handelurl(e.pic)?i("v-card",{attrs:{elevation:"0"}},[i("v-img",{staticClass:"text-right pa-2",attrs:{src:e.pic,height:"150"}},[i("v-fade-transition",[s?i("v-overlay",{attrs:{absolute:"",color:"#272727"}},[i("v-btn",{staticClass:"mx-1",attrs:{fab:"",large:"",color:"blue"},on:{click:function(i){return t.editcard(e)}}},[i("v-icon",[t._v("mdi-content-save-edit")])],1),i("v-btn",{staticClass:"mx-1",attrs:{fab:"",large:"",color:"blue"},on:{click:function(i){return t.delcard(e)}}},[i("v-icon",[t._v("mdi-delete")])],1)],1):t._e()],1)],1)],1):i("v-card",{attrs:{elevation:"0"}},[i("d-player",{attrs:{options:t.urlRoptions(e.pic)}}),i("v-card-actions",{staticClass:"d-flex justify-center"},[i("v-btn",{staticClass:"mx-3",attrs:{fab:"",small:""},on:{click:function(i){return t.editcard(e)}}},[i("v-icon",[t._v("mdi-content-save-edit")])],1),i("v-btn",{staticClass:"mx-3",attrs:{fab:"",small:""},on:{click:function(i){return t.delcard(e)}}},[i("v-icon",[t._v("mdi-delete")])],1)],1)],1)],1)]}}],null,!0)})],1)})),i("v-col",{staticClass:"d-flex justify-center align-center",attrs:{cols:"12",md:"6"}},[i("v-btn",{attrs:{color:"pink",icon:"",height:"120",width:"120"},on:{click:t.addcard}},[i("v-icon",{attrs:{dark:"",size:"120"}},[t._v("mdi-plus")])],1)],1)],2)],1)],1),i("v-row",1===e?[i("v-col",{staticClass:"d-flex justify-center"},[i("v-btn",{attrs:{color:"primary"},on:{click:function(i){return t.nextStep(e)}}},[t._v("下一步")]),i("v-btn",{attrs:{text:""},on:{click:t.cancel}},[t._v("取消")])],1)]:[i("v-col",{staticClass:"d-flex justify-center"},[2===e?i("v-btn",{attrs:{color:"primary"},on:{click:function(i){return t.nextStep(e)}}},[t._v("完成")]):t._e()],1)],1)],1)})),1)]],2)],1)},s=[],r=(i("4de4"),i("ac1f"),i("1276"),i("1dce")),n=i("b5ae"),o=i("71ee"),c=i.n(o),l=(i("4da9"),{components:{"d-player":c.a},mixins:[r["validationMixin"]],validations:{title:{required:n["required"],maxLength:Object(n["maxLength"])(80)},location:{required:n["required"],maxLength:Object(n["maxLength"])(50)},date:{required:n["required"]}},data:function(){return{e1:1,steps:2,altLabels:!1,editable:!0,pic:null,picurl:"",load:!1,imgshow:!1,id:null,title:"",items:[],selected:[],location:"",date:"",menu:!1,overlay:!1}},beforeRouteLeave:function(t,e,i){i()},created:function(){var t=this.$route.params.step||null;null!==t&&(this.e1=t);var e=this.$store.state.trip;null!==e.id&&(this.id=e.id,this.title=e.title,this.picurl=e.picurl,this.date=e.firstday,this.location=e.location,this.imgshow=!0,this.items=e.cards)},watch:{steps:function(t){this.e1>t&&(this.e1=t)},vertical:function(){var t=this;this.e1=2,requestAnimationFrame((function(){return t.e1=1}))}},computed:{titleErrors:function(){var t=[];return this.$v.title.$dirty?(!this.$v.title.required&&t.push("标题必填"),!this.$v.title.maxLength&&t.push("标题最长80字符串"),t):t},locationErrors:function(){var t=[];return this.$v.location.$dirty?(!this.$v.location.required&&t.push("地点必填"),!this.$v.location.maxLength&&t.push("地点最长50字符串"),t):t},dateErrors:function(){var t=[];return this.$v.date.$dirty?(!this.$v.date.required&&t.push("日期必填"),1===this.datetab(this.date,(new Date).toLocaleDateString())&&t.push("日期必须小于今天"),t):t}},methods:{nextStep:function(t){t===this.steps?this.activetrip():(this.tripcreate(),""!==this.title&&""!==this.picurl&&(this.e1+=1))},uploadfile:function(){var t=this;if(void 0!==this.pic){this.imgshow=!0,this.load="info";var e=new FormData;e.append("file",this.pic);var i={Authorization:"jwt ".concat(this.$store.state.user.token),"Content-Type":"multipart/form-data"};this.axios.post("/file/",e,{headers:i}).then((function(e){t.picurl=e.data.data,t.load=!1})).catch((function(e){t.$store.dispatch("updateAlter",{msg:"图片上传失败",msgType:"error",msgShow:!0}),t.imgshow=!1,t.picurl="",t.load=!1}))}},clickclear:function(){this.imgshow=!1,this.pic=null,this.picurl="",this.load=!1},cancel:function(){null!==this.id&&this.deltrip(),this.clearData(),this.$router.push({name:"Home"})},tripcreate:function(){var t=this;this.$v.$touch(),this.$v.$error||""===this.picurl||this.$nextTick((function(){t.submitnext()}))},submitnext:function(){var t=this;if(null===this.id){var e={pic:this.picurl,title:this.title,firstday:this.date,location:this.location},i={Authorization:"jwt ".concat(this.$store.state.user.token)};this.axios.post("/trip/",e,{headers:i}).then((function(e){var i=e.data.data;t.id=i.id;var a={id:t.id,title:t.title,picurl:t.picurl,firstday:t.date,location:t.location};t.$store.dispatch("updateTrip",a)})).catch((function(e){t.$store.dispatch("updateAlter",{msg:"网络异常",msgType:"error",msgShow:!0})}))}else{var a={pic:this.picurl,title:this.title,firstday:this.date,location:this.location},s={Authorization:"jwt ".concat(this.$store.state.user.token)};this.axios.patch("/trip/".concat(this.id,"/"),a,{headers:s}).then((function(e){var i={id:t.id,title:t.title,picurl:t.picurl,firstday:t.date,location:t.location};t.$store.dispatch("updateTrip",i)})).catch((function(e){t.$store.dispatch("updateAlter",{msg:"网络异常",msgType:"error",msgShow:!0})}))}},addcard:function(){null===this.id||null===this.$store.state.trip.id?this.$store.dispatch("updateAlter",{msg:"请先完成第一步创建游记",msgType:"info",msgShow:!0}):this.$router.push("/cards/create")},activetrip:function(){var t=this,e={status:"1"},i={Authorization:"jwt ".concat(this.$store.state.user.token)};this.axios.patch("/trip/".concat(this.id,"/"),e,{headers:i}).then((function(e){t.clearData(),t.$store.dispatch("updateAlter",{msg:"创建游记成功",msgType:"success",msgShow:!0}),t.$router.push({name:"Trip",params:{tripId:t.id}})})).catch((function(e){t.$store.dispatch("updateAlter",{msg:"网络异常",msgType:"error",msgShow:!0})}))},clearData:function(){this.$store.dispatch("clearTrip"),this.pic=null,this.picurl="",this.load=!1,this.imgshow=!1,this.id=null,this.title="",this.items=[],this.selected=[]},deltrip:function(){var t=this,e=this.id,i={Authorization:"jwt ".concat(this.$store.state.user.token)};this.axios.delete("/trip/".concat(e,"/"),{headers:i}).then((function(e){t.$store.dispatch("updateAlter",{msg:e.data.msg,msgType:"success",msgShow:!0}),t.$router.push({name:"Home"})})).catch((function(e){t.$store.dispatch("updateAlter",{msg:"网络异常,删除失败",msgType:"error",msgShow:!0})}))},datetab:function(t,e){var i=new Date(t),a=new Date(e);return i.getTime()>a.getTime()?1:i.getTime()==a.getTime()?0:-1},editcard:function(t){this.$router.push({name:"Edit",params:{cardId:t.id,flag:!0}})},delcard:function(t){var e=this,i=t.id,a={Authorization:"jwt ".concat(this.$store.state.user.token)};this.axios.delete("/card/".concat(i,"/"),{headers:a}).then((function(i){e.items=e.items.filter((function(e){return e.id!=t.id}));var a={cards:e.items};e.$store.dispatch("updateTrip",a)})).catch((function(t){e.$store.dispatch("updateAlter",{msg:"网络异常,删除失败",msgType:"error",msgShow:!0})}))},handelurl:function(t){if("string"===typeof t){var e=t.split("."),i=e[e.length-1];return"mp4"===i?"video":"img"}return null},urlRoptions:function(t){return{video:{url:t,type:"normal"},autoplay:!1,hotkey:!0}}}}),u=l,d=i("2877"),h=i("6544"),p=i.n(h),v=i("8336"),m=i("b0af"),f=i("99d9"),g=i("62ad"),b=i("2e4b"),y=i("0789"),$=i("23a7"),x=i("16b7"),w=i("f2e7"),k=i("58df"),S=i("d9bd"),A=Object(k["a"])(x["a"],w["a"]).extend({name:"v-hover",props:{disabled:{type:Boolean,default:!1},value:{type:Boolean,default:void 0}},methods:{onMouseEnter:function(){this.runDelay("open")},onMouseLeave:function(){this.runDelay("close")}},render:function(){return this.$scopedSlots.default||void 0!==this.value?(this.$scopedSlots.default&&(t=this.$scopedSlots.default({hover:this.isActive})),Array.isArray(t)&&1===t.length&&(t=t[0]),t&&!Array.isArray(t)&&t.tag?(this.disabled||(t.data=t.data||{},this._g(t.data,{mouseenter:this.onMouseEnter,mouseleave:this.onMouseLeave})),t):(Object(S["c"])("v-hover should only contain a single element",this),t)):(Object(S["c"])("v-hover is missing a default scopedSlot or bound value",this),null);var t}}),_=i("132d"),V=i("adda"),T=i("ade3"),j=i("4e82"),C=i("2b0e"),q=C["a"].extend({props:{activeClass:String,value:{required:!1}},data:function(){return{isActive:!1}},methods:{toggle:function(){this.isActive=!this.isActive}},render:function(){return this.$scopedSlots.default?(this.$scopedSlots.default&&(t=this.$scopedSlots.default({active:this.isActive,toggle:this.toggle})),Array.isArray(t)&&1===t.length&&(t=t[0]),t&&!Array.isArray(t)&&t.tag?(t.data=this._b(t.data||{},t.tag,{class:Object(T["a"])({},this.activeClass,this.isActive)}),t):(Object(S["c"])("v-item should only contain a single element",this),t)):(Object(S["c"])("v-item is missing a default scopedSlot",this),null);var t}}),L=Object(k["a"])(q,Object(j["a"])("itemGroup","v-item","v-item-group")).extend({name:"v-item"}),O=i("604c"),D=i("e449"),E=i("a797"),I=i("0fd9"),z=i("2fa4"),F=i("7e85"),M=i("e516"),H=i("9c54"),R=i("56a4"),B=i("8654"),G=Object(d["a"])(u,a,s,!1,null,null,null);e["default"]=G.exports;p()(G,{VBtn:v["a"],VCard:m["a"],VCardActions:f["a"],VCardText:f["c"],VCardTitle:f["d"],VCol:g["a"],VDatePicker:b["a"],VFadeTransition:y["c"],VFileInput:$["a"],VHover:A,VIcon:_["a"],VImg:V["a"],VItem:L,VItemGroup:O["b"],VMenu:D["a"],VOverlay:E["a"],VRow:I["a"],VSpacer:z["a"],VStepper:F["a"],VStepperContent:M["a"],VStepperHeader:H["a"],VStepperItems:H["b"],VStepperStep:R["a"],VTextField:B["a"]})}}]);
//# sourceMappingURL=chunk-2d0b3401.8274c213.js.map